(function(b,e,d){var a=b(document);d=e.Modernizr;b(document).ready(function(){b.fn.foundationAlerts&&a.foundationAlerts();b.fn.foundationButtons&&a.foundationButtons();b.fn.foundationAccordion&&a.foundationAccordion();b.fn.foundationNavigation&&a.foundationNavigation();b.fn.foundationTopBar&&a.foundationTopBar();b.fn.foundationCustomForms&&a.foundationCustomForms();b.fn.foundationMediaQueryViewer&&a.foundationMediaQueryViewer();b.fn.foundationTabs&&a.foundationTabs({callback:b.foundation.customForms.appendCustomMarkup});
b.fn.foundationTooltips&&a.foundationTooltips();b.fn.foundationMagellan&&a.foundationMagellan();b.fn.foundationClearing&&a.foundationClearing();b.fn.placeholder&&b("input, textarea").placeholder()});d.touch&&!e.location.hash&&b(e).load(function(){setTimeout(function(){e.scrollTo(0,1)},0)})})(jQuery,this);var BundleContentNode=function(){function b(b,d,a,c){this.url=b;this.name=d;this.parent=a;this.children=c}b.prototype.isRootNode=function(){return void 0===this.parent};b.prototype.isLeafNode=function(){return null===this.children};b.prototype.getUrl=function(){return this.url};b.prototype.getName=function(){return this.name};b.prototype.getFullName=function(){return this.isRootNode()?this.name:[this.parent.getFullName(),this.name].join("/")};b.prototype.getParent=function(){return this.parent};b.prototype.getChildren=
function(){return this.children};b.prototype.setChildren=function(b){this.children=b};b.prototype.getData=function(){return this.data};b.prototype.setData=function(b){this.data=b};return b}(),BundleRenderer=function(){function b(b){this.template=b}b.loadContentAsync=function(e,d){console.log("loadContentAsync");$.ajax({type:"GET",url:[d.getUrl(),d.getFullName()].join("/"),cache:!1,success:function(a){console.log(a);console.log("");var c=[];Array.isArray(a)&&2==a.length&&(c=a[0].map(function(a){return new BundleContentNode(d.getUrl(),
a,d)}),a=a[1].map(function(a){return new BundleContentNode(d.getUrl(),a,d,null)}),c=c.concat(a).sort(function(a,c){return a.getName().localeCompare(c.getName())}));d.setChildren(c);b.renderTable(e,b.getContentTableModel(d,e))},error:function(a,c,b){}})};b.loadFileContentAsync=function(e,d){console.log("loadFileContentAsync");$.ajax({type:"GET",url:[d.getUrl().replace("api/bundles/content","api/bundles/filecontent"),d.getFullName()].join("/"),cache:!1,success:function(a){console.log(a);console.log("");
d.setData(a);b.renderTable(e,b.getContentTableModel(d,e))},error:function(a,c,b){}})};b.getContentTableModel=function(e,d){var a=0;!1===e.isRootNode()&&(a+=1);if(e.isLeafNode())a+=1;else{var c=e.getChildren();void 0!==c&&(a+=c.length)}var f=function(a){a.setAttribute("class","col bundle__file_view__icon");var c=document.createElement("i");c.setAttribute("class","fi-arrow-left");a.appendChild(c);c.onclick=function(a){b.loadContentAsync(d,e.getParent());a.preventDefault()}},g=function(a){a.setAttribute("class",
"col bundle-item-type-goup");for(var c=[],f=e.getParent();void 0!==f;)c.push(f),f=f.getParent();c.reverse().forEach(function(c){var f=document.createElement("a");f.textContent=c.getName();f.setAttribute("href","");f.onclick=function(a){b.loadContentAsync(d,c);a.preventDefault()};a.appendChild(f);a.appendChild(document.createTextNode(" / "))});a.appendChild(document.createTextNode(e.getName()))},h=function(a,c){a.setAttribute("class","col bundle__file_view__icon");var b=document.createElement("i");
void 0!==c&&b.setAttribute("class",c.isLeafNode()?"fi-page":"fi-folder");a.appendChild(b)},m=function(a,c){if(c.isLeafNode()){a.setAttribute("class","col");var f=document.createElement("a");f.textContent=c.getName();f.setAttribute("href","");f.onclick=function(a){b.loadFileContentAsync(d,c);a.preventDefault()}}else a.setAttribute("class","col bundle-item-type-folder"),f=document.createElement("a"),f.textContent=c.getName(),f.setAttribute("href",""),f.onclick=function(a){b.loadContentAsync(d,c);a.preventDefault()};
a.appendChild(f)},c=function(a,c){var b=document.createElement("img"),f=[c.getUrl().replace("api/bundles/content","api/bundles/filecontent"),c.getFullName()].join("/");b.setAttribute("src",f);b.setAttribute("style","max-width:900px");return[b]},k=function(a,c){var b=document.createElement("iframe"),f=[c.getUrl().replace("api/bundles/content","api/bundles/filecontent"),c.getFullName()].join("/");b.setAttribute("src",f);b.setAttribute("style","width:100%; min-height:"+Math.max(200,Math.min(900,screen.height/
2))+"px;");return[b]},l={txt:function(a,c){var b=document.createElement("pre");b.setAttribute("class","bundle__file_pre");b.textContent=c.getData();return[b]},htm:k,html:k,jpg:c,png:c},n=function(a,c){var b=c.getName(),f="";0<b.indexOf(".")&&(f=b.toLowerCase().split(".").pop());b=l[f];void 0===b&&(b=l.txt);a.setAttribute("class","col");b(a,c).forEach(function(c){a.appendChild(c)})};return{tableDecorations:"bundle__file_view expanded",rowDecorations:"row",numRows:a,numCols:2,render:function(a,c,b){if(!1===
e.isRootNode()&&0>=a)0==c?f(b):g(b);else if(!0===e.isLeafNode())0==c?h(b):n(b,e);else{var d=0;!1===e.isRootNode()&&(d=1);a=e.getChildren()[a-d];0==c?h(b,a):m(b,a)}}}};b.getMetadataTableModel=function(b){var d=[],a;for(a in b.metadata)console.log(a),"description"==a&&d.push([a,b.metadata[a]]);return{tableDecorations:"bundle__meta_table",rowDecorations:"row",numRows:d.length,numCols:2,render:function(a,b,g){0==b?g.setAttribute("class","col bundle__meta_type"):g.setAttribute("class","col");g.textContent=
d[a][b]}}};b.getElementType=function(b,d){return void 0!==b?b:d};b.renderTable=function(e,d){var a=b.getElementType(d.tableElementType,"table"),c=b.getElementType(d.rowElementType,"tr"),f=b.getElementType(d.columnElementType,"td"),a=document.createElement(a);void 0!==d.tableDecorations&&a.setAttribute("class",d.tableDecorations);for(var g=0;g<d.numRows;g++){var h=document.createElement(c);if(0<d.numCols)for(var m=0;m<d.numCols;m++){var k=document.createElement(f);d.render(g,m,k);h.appendChild(k)}else d.render(g,
h);a.appendChild(h)}void 0!=e.firstChild&&e.removeChild(e.firstChild);e.appendChild(a)};b.prototype.render=function(e){var d=$(this.template.cloneNode(!0));d.find(".bundle-name").text(e.metadata.name);d.find(".bundle-icon-sm").removeClass("bundle-icon-sm").addClass("bundle-icon-sm--"+e.bundle_type+"--"+e.state);d.find(".bundle-uuid").text(e.uuid);d.find(".bundle-link").attr("href","/bundles/"+e.uuid);d.find(".bundle-download").on("click",function(a){a.preventDefault();console.log(a);console.log(c.get(0));
root=new BundleContentNode("/api/bundles/content",e.uuid);console.log(root)});var a=d.find(".bundle-meta-view-container").get(0);b.renderTable(a,b.getMetadataTableModel(e));var a=d.find(".bundle__expand_button"),c=d.find(".bundle-file-view-container");a.on("click",function(a){var g=$(a.target);if(g.hasClass("expanded"))c.removeClass("expanded"),c.children().removeClass("expanded"),g.removeClass("expanded"),g.html('SHOW BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="More">');else{if(void 0==
c.get(0).firstChild){var h=new BundleContentNode("/api/bundles/content",e.uuid);b.loadContentAsync(c.get(0),h)}else c.children().addClass("expanded");c.addClass("expanded");g.addClass("expanded");g.html('HIDE BUNDLE CONTENT<img src="/static/img/expand-arrow.png" alt="Less">')}a.preventDefault()});return d.get(0)};return b}(),WorkshhetDirectiveRenderer=function(){return function(){var b=this;b.display="inline";b.bundleBlock=null;b.tableDirective=[];b.applyDirective=function(e,d){switch(d[1].directive){case "display":b.display=
d[1].display;b.applyPendingDirectives(e);break;case "image":$(e).append($("<img />",{src:"/api/bundles/filecontent/"+b.bundleBlock.uuid+"/"+encodeURI(d[1].path),"class":"bundleImage",alt:d[1].name}));break;case "metadata":b.tableDirective.push(d[1])}};b.insertRowTable=function(b,d,a){var c=$("<tr></tr>");d.forEach(function(b){c.append($(a).text(b))});b.append(c)};b.getDataFromPath=function(e){return b.bundleBlock.metadata[e]};b.applyPendingDirectives=function(e){if(0<b.tableDirective.length){var d=
$("<table></table>");if("table"===b.display){var a=$("<thead></thead>");b.insertRowTable(a,b.tableDirective.map(function(a){return a.name}),"<th></th>")}var c=$("<tbody></tbody>");"table"===b.display?b.insertRowTable(c,b.tableDirective.map(function(a){return b.getDataFromPath(a.path)}),"<td></td>"):b.tableDirective.forEach(function(a){b.insertRowTable(c,[a.name,b.getDataFromPath(a.path)],"<td></td>")});d.append(a);d.append(c);$(e).append(d);b.tableDirective=[]}}}}(),WorksheetRenderer=function(){return function(b,
e,d){this.renderer=e;if(d&&d.items&&Array.isArray(d.items)){var a=this;e=d.name;var c=d.items.filter(function(a){return"title"===a[2]});0<c.length&&(e=markdown.toHTML("#"+c[0][1]).replace(/^<h1>/,"").replace(/<\/h1>$/,""));$(".worksheet-icon").html(e);$(".worksheet-author").html("by "+d.owner);var f=new WorkshhetDirectiveRenderer,g="";d.items.push([null,"eof",null]);d.items.forEach(function(c,d,e){"directive"!=c[2]&&f.applyPendingDirectives(b);if("markup"!=c[2]&&0<g.length){var l=document.createElement("div");
l.innerHTML=markdown.toHTML(g);b.appendChild(l);g=""}switch(c[2]){case "markup":g+=c[1]+"\n\r";break;case "bundle":b.appendChild(a.renderer.render(c[0]));break;case "directive":e.slice(d+1).forEach(function(a){"bundle"==a[2]&&(f.bundleBlock=a[0])}),f.applyDirective(b,c)}});MathJax.Hub.Queue(["Typeset",MathJax.Hub,b.id]);MathJax.Hub.Queue(function(){for(var a=MathJax.Hub.getAllJax(),c=0;c<a.length;c+=1)$(a[c].SourceElement().parentNode).addClass("coda-jax")})}}}();var Competition;
(function(b){function e(a,c){0<$("#disallow_leaderboard_modifying").length?a.text("Leaderboard modifying disallowed").attr("disabled","disabled"):c?(a.removeClass("leaderBoardSubmit"),a.addClass("leaderBoardRemove"),a.text("Remove from Leaderboard")):(a.removeClass("leaderBoardRemove"),a.addClass("leaderBoardSubmit"),a.text("Submit to Leaderboard"))}function d(a,c,b,d){a="/api/competition/"+a+"/submission/"+c+"/leaderboard";var h="";d.hasClass("leaderBoardSubmit")?h="post":d.hasClass("leaderBoardRemove")&&(h=
"delete");request=$.ajax({url:a,type:h,datatype:"text",data:{csrfmiddlewaretoken:b},success:function(a,b,f){(a="post"==h)?(b=$("#user_results td.status"),b.removeClass("submitted"),b.addClass("not_submitted"),b.html(""),b=$("#"+c+" td.status"),b.addClass("submitted"),b.html("<i class='fi-check'></i>"),$("#user_results button.leaderBoardRemove").each(function(a){e($(this),!1)})):(b=$("#"+c+" td.status"),b.removeClass("submitted"),b.addClass("not_submitted"),b.html(""));e(d,a)},error:function(a,c,b){alert("An error occurred. Please try again or report the issue")},
beforeSend:function(a){a.setRequestHeader("X-CSRFToken",b)}})}b.invokePhaseButtonOnOpen=function(a){var c=$("#"+a+" .button.selected")[0];void 0===c&&(c=$("#"+a+" .button.active")[0],void 0===c&&(c=$("#"+a+" .button")[0]));c.click()};b.getPhaseSubmissions=function(a,c,f){$(".competition_submissions").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/submissions/"+c,cache:!1,success:function(c){$(".competition_submissions").html("").append(c);
!1===CodaLab.FileUploader.isSupported()?($("#fileUploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new CodaLab.FileUploader({buttonId:"fileUploadButton",sasEndpoint:"/api/competition/"+a+"/submission/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,c){$("#fileUploadButton").addClass("disabled")},afterSelection:function(a,c){!1===
c&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#fileUploadButton").removeClass("disabled"))},uploadProgress:function(a,c,b){c=100*c/b;$("#details").html("Uploading file <em>"+a.name+"</em>: "+c.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");
$("#fileUploadButton").removeClass("disabled")},uploadSuccess:function(c,f){$("#details").html("Creating new submission...");$.ajax({url:"/api/competition/"+a+"/submission",type:"post",cache:!1,data:{id:f,name:c.name,type:c.type,size:c.size}}).done(function(a){$("#details").html("");$("#user_results tr.noData").remove();$("#user_results").append(b.displayNewSubmission(a));$("#user_results #"+a.id+" .fi-plus").on("click",function(){b.showOrHideSubmissionDetails(this)});$("#fileUploadButton").removeClass("disabled");
$("#user_results #"+a.id+" .fi-plus").click()}).fail(function(a){var c="An unexpected error occurred.";403==a.status&&(c=a.responseJSON.detail);$("#details").html(c);$("#fileUploadButton").removeClass("disabled")})}});$("#user_results .fi-plus").on("click",function(){b.showOrHideSubmissionDetails(this)})},error:function(a,c,b){$(".competition_submissions").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};b.getPhaseResults=function(a,c){$(".competition_results").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",
display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/results/"+c,cache:!1,success:function(a){$(".competition_results").html("").append(a);$(".column-selectable").click(function(a){a=$(this).closest("table");$(a).find(".column-selected").removeClass();$(this).addClass("column-selected");var c=$(this).attr("name");a=a.find("td").filter(function(){return $(this).attr("name")===c}).addClass("column-selected");if(0<a.length)for(var b=a.slice().sort(function(a,c){var b=parseInt($.text([$(a).find("span")]));
isNaN(b)&&(b=1E5);var f=parseInt($.text([$(c).find("span")]));isNaN(f)&&(f=1E5);return b-f}),f=a[0].parentNode.parentNode,b=b.map(function(){return this.parentNode.cloneNode(!0)}),d=0;d<b.length;d++)$(b[d]).find("td.row-position").text($(b[d]).find("td.column-selected span").text()),f.insertBefore(b[d],a[d].parentNode),f.removeChild(a[d].parentNode)})},error:function(a,c,b){$(".competition_results").html("<div class='alert-error'>An error occurred. Please try refreshing the page.</div>")}})};b.registationCanProceed=
function(){!0===$("#checkbox").is(":checked")?$("#participateButton").removeClass("disabledStatus"):$("#participateButton").addClass("disabledStatus")};b.displayRegistrationStatus=function(a){var c="";$.ajax({type:"GET",url:"/api/competition/"+a+"/mystatus/",cache:!1,success:function(a){console.log(a);"approved"==a.status?location.reload():"pending"==a.status?(c="<div class='participateInfoBlock pendingApproval'>",c+="<div class='infoStatusBar'></div>",c+="<div class='labelArea'>",c+="<label class='regApprovLabel'>Your request to participate in this challenge has been received and a decision is pending.</label>",
c+="<label></label>",c+="</div>",c+="</div>"):"denied"==a.status&&(c="<div class='participateInfoBlock'>",c+="<div class='infoStatusBar'></div>",c+="<div class='labelArea'>",c+="<label class='regDeniedLabel'>Your request to participate in this challenge has been denied. The reason for your denied registrations is: "+a.reason+"</label>",c+="<label></label>",c+="</div>",c+="</div>");location.reload()},error:function(a,c,b){$(".competition_results").html("<div class='alert - error'>An error occurred. Please try refreshing the page.</div>")}});
return c};b.displayNewSubmission=function(a){var c=$("#submission_details_template #submission_row_template tr").clone();$(c).attr("id",a.id.toString());$(c).addClass(b.oddOrEven(a.submission_number));$(c).children().each(function(f){switch(f){case 0:"finished"===a.status&&($(this).val("1"),0<$("#forced_to_leaderboard").length&&($(".fi-check").remove(),$($(c).children("td")[4]).html('<i class="fi-check"></i>')));break;case 1:$(this).html(a.submission_number.toString());break;case 2:$(this).html(a.filename);
break;case 3:var d=function(a){a=a.toString();1==a.length&&(a="0"+a);return a},h=new Date(a.submitted_at);f=h.getDate().toString()+"/"+h.getMonth().toString()+"/"+h.getFullYear();var e=h.getHours().toString(),k=d(h.getMinutes()),d=d(h.getSeconds());$(this).html(f+" "+e+":"+k+":"+d);break;case 4:$(this).html(b.getSubmissionStatus(a.status))}});return c};b.oddOrEven=function(a){return a&1?"odd":"even"};b.getSubmissionStatus=function(a){var c="Unknown";"submitting"===a?c="Submitting":"submitted"===a?
c="Submitted":"running"===a?c="Running":"failed"===a?c="Failed":"cancelled"===a?c="Cancelled":"finished"===a&&(c="Finished");return c};b.showOrHideSubmissionDetails=function(a){var c=$(a).parents("tr")[0];if($(a).hasClass("fi-minus"))$(a).removeClass("fi-minus"),$(a).addClass("fi-plus"),$(c).next("tr.trDetails").remove();else{$(a).removeClass("fi-plus");$(a).addClass("fi-minus");a=$("#submission_details_template .trDetails").clone();a.find(".tdDetails").attr("colspan",c.cells.length);a.find("a").each(function(a){$(this).attr("href",
$(this).attr("href").replace("_",c.id))});var f=$("#phasestate").val(),g=$(c).find("input[name='state']").val();if(1==f&&1==g){var h=a.find("button");h.removeClass("hide");var f=$(c).find(".status").hasClass("submitted"),m=$("#competitionId").val();e(h,f);h.on("click",function(){d(m,c.id,$("#cstoken").val(),h)})}else{f=$.trim($(c).find(".statusName").html());h=a.find("button").addClass("hide");if("Submitting"===f||"Submitted"===f||"Running"===f)h.removeClass("hide"),h.text("Refresh status"),h.on("click",
function(){b.updateSubmissionStatus($("#competitionId").val(),c.id,this)});"Failed"!==f&&"Cancelled"!==f||a.find("a").removeClass("hide")}$(c).after(a)}};b.updateSubmissionStatus=function(a,c,f){$(f).parents(".submission_details").find(".preloader-handler").append("<div class='competitionPreloader'></div>").children().css({top:"25px",display:"block"});$.ajax({type:"GET",url:"/api/competition/"+a+"/submission/"+c,cache:!1,success:function(g){$("#user_results #"+c).find(".statusName").html(b.getSubmissionStatus(g.status));
if("finished"===g.status)$("#user_results #"+c+"input:hidden").val("1"),1==$("#phasestate").val()?(0<$("#disallow_leaderboard_modifying").length?($(f).text("Leaderboard modifying disallowed").attr("disabled","disabled"),0<$("#forced_to_leaderboard").length&&($(".fi-check").remove(),$($("#"+c+" td")[4]).html('<i class="fi-check"></i>'))):0==$("#forced_to_leaderboard").length?($(f).addClass("leaderBoardSubmit"),$(f).text("Submit to Leaderboard")):($(".fi-check").remove(),$($("#"+c+" td")[4]).html('<i class="fi-check"></i>'),
$(f).removeClass("leaderBoardSubmit"),$(f).addClass("leaderBoardRemove"),$(f).text("Remove from Leaderboard")),$(f).unbind("click").off("click").on("click",function(){d(a,c,$("#cstoken").val(),$(f))})):$(f).addClass("hide");else if("failed"===g.status||"cancelled"===g.status)$(f).addClass("hide"),$(f).parent().parent().find("a").removeClass("hide"),$("a[href='traceback/"+c+"/']").parent().html("<pre>"+g.extra.traceback+"</pre>");$(".competitionPreloader").hide()},error:function(a,c,b){}})};b.initialize=
function(){$(document).ready(function(){$("#participate_form").submit(function(a){a.preventDefault();if($("#participateButton").hasClass("disabledStatus"))return!1;$("#result").html("");a=$(this).serialize();var f=$("#competitionId").val();request=$.ajax({url:"/api/competition/"+f+"/participate/",type:"post",dataType:"text",data:a,success:function(a,c,d){$(".content form").replaceWith(b.displayRegistrationStatus(f))},error:function(a,c,b){alert("There was a problem registering for this competition.")}});
return!1});$("#submissions_phase_buttons .button").each(function(a,f){$(this).click(function(){var a=$.trim($(this).attr("id").replace("submissions_phase_",""));$("#submissions_phase_buttons .button").removeClass("selected");$(this).addClass("selected");var c=$("#competitionId").val(),f=$("#cstoken").val();b.getPhaseSubmissions(c,a,f)})});$("a[href='#participate-submit_results']").click(function(a){b.invokePhaseButtonOnOpen("submissions_phase_buttons")});$("#results_phase_buttons .button").each(function(a,
f){$(this).click(function(){var a=$.trim($(this).attr("id").replace("results_phase_",""));$("#results_phase_buttons .button").removeClass("selected");$(this).addClass("selected");var c=$("#competitionId").val();b.getPhaseResults(c,a)})});$("#Results").click(function(a){b.invokePhaseButtonOnOpen("results_phase_buttons")});$(this).foundation("section","reflow");$(".top-bar-section ul > li").removeClass("active");$("#liCompetitions").addClass("active");$(".my_managing .competition-tile #competition-actions").each(function(a,
b){$(this).children("#competition-publish-button").click(function(){var a=$(this).parent()[0];request=$.ajax({url:$(this)[0].value,success:function(c,b,f){console.log("Published competition.");$(a).children("#competition-publish-button").hide();$(a).children("#competition-delete-button").hide();$(a).children("#competition-unpublish-button").show()},error:function(a,c,b){a=$.parseJSON(a.responseJSON);a.error&&alert(a.error);console.log("Error publishing competition!")}})});$(this).children("#competition-unpublish-button").click(function(){});
"True"==$(this)[0].getAttribute("published")?($(this).children("#competition-delete-button").hide(),$(this).children("#competition-publish-button").hide(),$(this).children("#competition-unpublish-button").show()):($(this).children("#competition-delete-button").show(),$(this).children("#competition-publish-button").show(),$(this).children("#competition-unpublish-button").hide())});var a=window.location.href;void 0!==a&&(null!==a.match(/#participate-submit_results$/i)?b.invokePhaseButtonOnOpen("submissions_phase_buttons"):
null!==a.match(/#results$/i)&&b.invokePhaseButtonOnOpen("results_phase_buttons"))})}})(Competition||(Competition={}));var csrftoken;function csrfSafeMethod(b){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(b)}function sameOrigin(b){var e="//"+document.location.host,d=document.location.protocol+e;return b==d||b.slice(0,d.length+1)==d+"/"||b==e||b.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(b)}$(function(){csrftoken=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(b,e){!csrfSafeMethod(e.type)&&sameOrigin(e.url)&&b.setRequestHeader("X-CSRFToken",csrftoken)}})});var CodaLab;
(function(b){var e=function(){function b(a){var c=this;this.defaultOptions={buttonId:"fileUploadButton",disabledClassName:"disabled",beforeSelection:function(){},afterSelection:function(a,c){},uploadProgress:function(a,c,b){},uploadSuccess:function(a){},uploadError:function(a){},allowedFileTypes:void 0,extensionToFileType:{zip:"application/zip"},maxFileSizeInBytes:void 0,maxBlockSizeInBytes:1048576};this.options=$.extend({},this.defaultOptions,a);var f=$("#"+this.options.buttonId);this.setupFileInput();
f.after(this.fileInput);f.on("click",function(a){f.hasClass(c.options.disabledClassName)||c.fileInput.click()})}b.prototype.setupFileInput=function(){var a=this,c=this.fileInput;this.fileInput=$(document.createElement("input"));this.fileInput.attr("type","file");this.fileInput.attr("style","visibility: hidden; width: 1px; height: 1px;");this.fileInput.on("change",function(c){a.options.beforeSelection();c=a.validate();var e=0<c.files.length&&!0===b.selectionIsValid(c);a.options.afterSelection(c,e);
e?a.beginUpload(c,0):a.setupFileInput()});void 0!==c&&c.replaceWith(this.fileInput)};b.prototype.validate=function(){var a=this,c=this.fileInput.get(0).files,b=[];0<c.length&&$.each(c,function(c,d){var e=[];a.options.maxFileSizeInBytes&&d.size>a.options.maxFileSizeInBytes&&e.push({kind:"size-error"});var k=d.type;if(""===k){var l=d.name.split(".");1<l.length&&(k=a.options.extensionToFileType[l.pop().toLowerCase()])}a.options.allowedFileTypes&&-1===$.inArray(k,a.options.allowedFileTypes)&&e.push({kind:"type-error"});
b.push({file:d,errors:e})});return{files:b}};b.selectionIsValid=function(a){return 0===a.files.map(function(a){return a.errors.length}).reduce(function(a,b,d,e){return a+b},0)};b.prototype.getCurrentFile=function(){if(void 0!==this.state)return this.state.selection.files[this.state.fileIndex].file};b.prototype.getFileReader=function(){var a=this,c=new FileReader;c.onload=function(c){var b=a.state.sasUrl+"&comp=block&blockid="+a.state.blockIds[a.state.blockIds.length-1];c=new Uint8Array(c.target.result);
var d=a.state.sasVersion;$.ajax({url:b,type:"PUT",data:c,processData:!1,beforeSend:function(a){a.setRequestHeader("x-ms-version",d);a.setRequestHeader("x-ms-blob-type","BlockBlob")},success:function(c,b){var d=a.getCurrentFile();a.options.uploadProgress(d,a.state.bytesUploaded,d.size);a.state.bytesUploaded<d.size?a.upload():a.endUpload()},error:function(c,b,d){a.options.uploadError({kind:"write-error",jqXHR:c,file:a.getCurrentFile()})}})};c.onerror=function(c){a.options.uploadError({kind:"read-error",
message:c.message,file:a.getCurrentFile()})};return c};b.prototype.beginUpload=function(a,c){this.state={sasUrl:void 0,sasVersion:void 0,trackingId:void 0,reader:void 0,selection:a,fileIndex:c,blockIds:[],bytesUploaded:0};var b=this.getCurrentFile(),d=this;$.ajax({url:d.options.sasEndpoint,type:"POST",data:{name:b.name,type:b.type,size:b.size},success:function(a,c){d.state.sasUrl=a.url;d.state.sasVersion=a.version;d.state.trackingId=a.id;d.state.reader=d.getFileReader();d.options.uploadProgress(b,
d.state.bytesUploaded,b.size);d.upload()},error:function(a,c,b){d.options.uploadError({kind:"sas-error",jqXHR:a,file:d.getCurrentFile()})}})};b.prototype.upload=function(){var a=this.getCurrentFile(),c=this.state.bytesUploaded,b=c+Math.min(a.size-c,this.options.maxBlockSizeInBytes),a=a.slice(c,b),c="000000"+(this.state.blockIds.length+1),c=btoa(c.substring(c.length-6));this.state.blockIds.push(c);this.state.bytesUploaded=b;this.state.reader.readAsArrayBuffer(a)};b.prototype.endUpload=function(){var a=
this.state.sasUrl+"&comp=blocklist",c=this.getCurrentFile(),b=['<?xml version="1.0" encoding="utf-8"?>'];b.push("<BlockList>");for(var d=0;d<this.state.blockIds.length;d++)b.push("  <Latest>"+this.state.blockIds[d]+"</Latest>");b.push("</BlockList>");var e=this;$.ajax({url:a,type:"PUT",contentType:"application/xml",processData:!1,data:b.join("\n"),beforeSend:function(a){a.setRequestHeader("x-ms-version",e.state.sasVersion);a.setRequestHeader("x-ms-blob-content-type",c.type);a.setRequestHeader("x-ms-meta-name",
c.name);a.setRequestHeader("x-ms-meta-size",c.size.toString())},success:function(a,b){e.options.uploadSuccess(c,e.state.trackingId);var d=1+e.state.fileIndex;d<e.state.selection.files.length?e.beginUpload(e.state.selection,d):e.setupFileInput()},error:function(a,c,b){e.options.uploadError({kind:"write-error",jqXHR:a,file:e.getCurrentFile()})}})};b.isSupported=function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1};return b}();b.FileUploader=e;(function(b){b.CreateReady=
function(){!1===e.isSupported()?($("#uploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new e({buttonId:"uploadButton",sasEndpoint:"/api/competition/create/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,b){$("#uploadButton").addClass("disabled")},afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?
$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 1GB size limit.")),$("#uploadButton").removeClass("disabled"))},uploadProgress:function(a,b,d){b=100*b/d;$("#details").html("Uploading file <em>"+a.name+"</em>: "+b.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#uploadButton").removeClass("disabled")},uploadSuccess:function(a,
b){$("#details").html("Creating competition... This may take a while. Please be patient.");$.ajax({url:"/api/competition/create",type:"post",cache:!1,data:{id:b,name:a.name,type:a.type,size:a.size}}).done(function(a){var b=function(){$.ajax({url:"/api/competition/create/"+a.token,type:"get",cache:!1,data:{csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val()}}).done(function(a){"finished"==a.status?($("#details").html("Congratulations! Your new competition is ready to <a href='/competitions/"+
a.id+"'>view</a>. You can also manage it from <a href='/my/#manage'>your CodaLab dashboard.</a>"),$("#uploadButton").removeClass("disabled")):"failed"==a.status?($("#details").html("Oops! There was a problem creating the competition: <br><pre>"+a.error+"</pre>"),$("#uploadButton").removeClass("disabled")):setTimeout(b,1E3)}).fail(function(){$("#details").html("An unexpected error occurred.");$("#uploadButton").removeClass("disabled")})};b()}).fail(function(){$("#details").html("An unexpected error occurred.");
$("#uploadButton").removeClass("disabled")})}})}})(b.Competitions||(b.Competitions={}))})(CodaLab||(CodaLab={}));//# sourceMappingURL=/static/codalab.min.map
