var $jscomp={scope:{},findInternal:function(c,g,h){c instanceof String&&(c=String(c));for(var a=c.length,b=0;b<a;b++){var d=c[b];if(g.call(h,d,b,c))return{i:b,v:d}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,g,h){if(h.get||h.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[g]=h.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,g,h,a){if(g){h=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var b=c[a];b in h||(h[b]={});h=h[b]}c=c[c.length-1];a=h[c];g=g(a);g!=a&&null!=g&&$jscomp.defineProperty(h,c,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,h){return $jscomp.findInternal(this,c,h).v}},"es6-impl","es3");
(function(c,g,h){var a=c(document);h=g.Modernizr;c(document).ready(function(){c.fn.foundationAlerts&&a.foundationAlerts();c.fn.foundationButtons&&a.foundationButtons();c.fn.foundationAccordion&&a.foundationAccordion();c.fn.foundationNavigation&&a.foundationNavigation();c.fn.foundationTopBar&&a.foundationTopBar();c.fn.foundationCustomForms&&a.foundationCustomForms();c.fn.foundationMediaQueryViewer&&a.foundationMediaQueryViewer();c.fn.foundationTabs&&a.foundationTabs({callback:c.foundation.customForms.appendCustomMarkup});
c.fn.foundationTooltips&&a.foundationTooltips();c.fn.foundationMagellan&&a.foundationMagellan();c.fn.foundationClearing&&a.foundationClearing();c.fn.placeholder&&c("input, textarea").placeholder()});h.touch&&!g.location.hash&&c(g).load(function(){setTimeout(function(){g.scrollTo(0,1)},0)})})(jQuery,this);var Competition;
(function(c){function g(a,b){0<$("#disallow_leaderboard_modifying").length?a.text("Leaderboard modifying disallowed").attr("disabled","disabled"):b?(a.removeClass("leaderBoardSubmit"),a.addClass("leaderBoardRemove"),a.text("Remove from Leaderboard")):(a.removeClass("leaderBoardRemove"),a.addClass("leaderBoardSubmit"),a.text("Submit to Leaderboard"))}function h(a,b,d,c){a="/api/competition/"+a+"/submission/"+b+"/leaderboard";var f="";c.hasClass("leaderBoardSubmit")?f="post":c.hasClass("leaderBoardRemove")&&(f=
"delete");request=$.ajax({url:a,type:f,datatype:"text",data:{csrfmiddlewaretoken:d},success:function(a,d,e){(a="post"==f)?(d=$("#user_results td.status"),d.removeClass("submitted"),d.addClass("not_submitted"),d.html(""),d=$("#"+b+" td.status"),d.addClass("submitted"),d.html('<span class="glyphicon glyphicon-ok"></span>'),$("#user_results .leaderboard_button.leaderBoardRemove").each(function(a){g($(this),!1)})):(d=$("#"+b+" td.status"),d.removeClass("submitted"),d.addClass("not_submitted"),d.html(""));
g(c,a)},error:function(a,b,d){alert("An error occurred. Please try again or report the issue")},beforeSend:function(a){a.setRequestHeader("X-CSRFToken",d)}})}c.getPhaseSubmissions=function(a,b,d){$(".competition_submissions").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/submissions/"+b,cache:!1,success:function(b){$(".competition_submissions").html("").append(b);!1===CodaLab.FileUploader.isSupported()?
($("#fileUploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new CodaLab.FileUploader({buttonId:"fileUploadButton",sasEndpoint:"/api/competition/"+a+"/submission/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,validateBeforeFilePrompt:function(){if(0==$("#submission_method_name").length)return!0;var a=$("#submission_team_name").val(),b=$("#submission_method_name").val(),
d=$("#submission_method_description").val();return a&&""!==a&&b&&""!==b&&d&&""!==d},beforeSelection:function(a,b){$("#fileUploadButton").addClass("disabled")},afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?$("#details").html("Please select a valid file. Only ZIP files are accepted."):$("#details").html("The files that you selected is too large. There is a 20GB size limit.")),$("#fileUploadButton").removeClass("disabled"))},uploadProgress:function(a,
b,d){b=100*b/d;$("#details").html("Uploading file <em>"+a.name+"</em>: "+b.toFixed(0)+"% complete.")},uploadError:function(a){$("#details").html("There was an error uploading the file. Please try again.");$("#fileUploadButton").removeClass("disabled")},uploadSuccess:c.submitUploadedSubmissionDetails});$("#user_results .glyphicon-plus").on("click",function(){c.showOrHideSubmissionDetails(this)})},error:function(a,b,d){$(".competition_submissions").html("<div class='alert alert-error'>An error occurred. Please try refreshing the page.</div>")}})};
c.getPhaseResults=function(a,b){$(".competition_results").html("").append("<div class='competitionPreloader'></div>").children().css({top:"200px",display:"block"});$.ajax({type:"GET",url:"/competitions/"+a+"/results/"+b,cache:!1,success:function(a){$(".competition_results").html("").append(a);$(".column-selectable").click(function(a){a=$(this).closest("table");$(a).find(".column-selected").removeClass();$(this).addClass("column-selected");var b=$(this).attr("name");a=a.find("td").filter(function(){return $(this).attr("name")===
b}).addClass("column-selected");if(0<a.length)for(var d=a.slice().sort(function(a,b){var d=parseInt($.text([$(a).find("span")]));isNaN(d)&&(d=1E5);var c=parseInt($.text([$(b).find("span")]));isNaN(c)&&(c=1E5);return d-c}),c=a[0].parentNode.parentNode,d=d.map(function(){return this.parentNode.cloneNode(!0)}),e=0;e<d.length;e++)$(d[e]).find("td.row-position").text($(d[e]).find("td.column-selected span").text()),c.insertBefore(d[e],a[e].parentNode),c.removeChild(a[e].parentNode)})},error:function(a,
b,c){$(".competition_results").html("<div class='alert alert-error'>An error occurred. Please try refreshing the page.</div>")}})};c.getPublicPhaseSubmisisons=function(a,b){var d="public_results_phase_"+b;$("#results_phase_submissions .btn").removeClass("selected").removeClass("active");$("#"+d).addClass("active").addClass("selected");d="/competitions/"+a+"/public_submissions/"+b;$(".public_submission_results").html("").append("<div class='competitionPreloader'></div>").children().css({top:"300px",
display:"block"});$.ajax({type:"GET",url:d,cache:!1,success:function(a){$(".public_submission_results").html("").append(a)},error:function(a,b,d){$(".public_submission_results").html("<div class='alert alert-error'>An error occurred. Please try refreshing the page.</div>")}})};c.registationCanProceed=function(){!0===$("#checkbox").is(":checked")?$("#participateButton").removeClass("disabledStatus"):$("#participateButton").addClass("disabledStatus")};c.displayRegistrationStatus=function(a){var b="";
$.ajax({type:"GET",url:"/api/competition/"+a+"/mystatus/",cache:!1,success:function(a){console.log(a);"approved"==a.status?location.reload():"pending"==a.status?(b="<div class='participateInfoBlock pendingApproval'>",b+="<div class='infoStatusBar'></div>",b+="<div class='labelArea'>",b+="<label class='regApprovLabel'>Your request to participate in this challenge has been received and a decision is pending.</label>",b+="<label></label>",b+="</div>",b+="</div>"):"denied"==a.status&&(b="<div class='participateInfoBlock'>",
b+="<div class='infoStatusBar'></div>",b+="<div class='labelArea'>",b+="<label class='regDeniedLabel'>Your request to participate in this challenge has been denied. The reason for your denied registrations is: "+a.reason+"</label>",b+="<label></label>",b+="</div>",b+="</div>");location.reload()},error:function(a,b,c){$(".competition_results").html("<div class='alert - error'>An error occurred. Please try refreshing the page.</div>")}});return b};c.submitUploadedSubmissionDetails=function(a,b){var d=
$("#competitionId").val();$("#details").html("Creating new submission...");var e=$("#submission_description_textarea").val()||"",f=$("#submission_method_name").val()||"",h=$("#submission_method_description").val()||"",g=$("#submission_project_url").val()||"",l=$("#submission_publication_url").val()||"",m=$("#submission_bibtex").val()||"",n=$("#submission_team_name").val()||"",p=$("#submission_organization_or_affiliation").val()||"",q=$("#submission_phase_id").val();$("#submission_description_textarea").val("");
$.ajax({url:"/api/competition/"+d+"/submission?description="+encodeURIComponent(e)+"&method_name="+encodeURIComponent(f)+"&method_description="+encodeURIComponent(h)+"&project_url="+encodeURIComponent(g)+"&publication_url="+encodeURIComponent(l)+"&team_name="+encodeURIComponent(n)+"&organization_or_affiliation="+encodeURIComponent(p)+"&bibtex="+encodeURIComponent(m)+"&phase_id="+encodeURIComponent(q),type:"post",cache:!1,data:{id:b,name:a?a.name:"",type:a?a.type:"",size:a?a.size:""}}).done(function(a){$("#details").html("");
$("#user_results tr.noData").remove();$("#user_results").append(c.displayNewSubmission(a,e,f,h,g,l,m,n,p));$("#user_results #"+a.id+" .glyphicon-plus").on("click",function(){c.showOrHideSubmissionDetails(this)});$("#fileUploadButton").removeClass("disabled");$("#user_results #"+a.id+" .glyphicon-plus").click()}).fail(function(a){var b="An unexpected error occurred.";403==a.status&&(b=a.responseJSON.detail);$("#details").html(b);$("#fileUploadButton").removeClass("disabled")})};c.displayNewSubmission=
function(a,b,d,e,f,h,g,l,m){var k=$("#submission_details_template #submission_row_template tr").clone();$(k).attr("id",a.id.toString());$(k).addClass(c.oddOrEven(a.submission_number));void 0!==b&&""!==b&&$(k).attr("data-description",b);void 0!==d&&""!==d&&$(k).attr("data-method-name",d);void 0!==e&&""!==e&&$(k).attr("data-method-description",e);void 0!==f&&""!==f&&$(k).attr("data-project-url",f);void 0!==h&&""!==h&&$(k).attr("data-publication-url",h);void 0!==g&&""!==g&&$(k).attr("data-bibtex",g);
void 0!==l&&""!==l&&$(k).attr("data-team-name",l);void 0!==m&&""!==m&&$(k).attr("data-organization-or-affiliation",m);$(k).children().each(function(b){switch(b){case 0:"finished"===a.status&&($(this).val("1"),0<$("#forced_to_leaderboard").length&&($(".glyphicon-ok").remove(),$($(k).children("td")[4]).html('<span class="glyphicon glyphicon-ok"></span>')));break;case 1:$(this).html(a.submission_number.toString());break;case 2:$(this).html("---");break;case 3:$(this).html(a.filename);break;case 4:var d=
function(a){a=a.toString();1==a.length&&(a="0"+a);return a},e=new Date(a.submitted_at);b=("0"+(e.getMonth()+1).toString()).slice(-2)+"/"+e.getDate().toString()+"/"+e.getFullYear();var f=("0"+e.getHours().toString()).slice(-2),h=d(e.getMinutes()),d=d(e.getSeconds());$(this).html(b+" "+f+":"+h+":"+d);break;case 5:$(this).html(c.getSubmissionStatus(a.status))}});return k};c.oddOrEven=function(a){return a&1?"odd":"even"};c.getSubmissionStatus=function(a){var b="Unknown";"submitting"===a?b="Submitting":
"submitted"===a?b="Submitted":"running"===a?b="Running":"failed"===a?b="Failed":"cancelled"===a?b="Cancelled":"finished"===a&&(b="Finished");return b};c.toggleSubmissionPublic=function(a){a.preventDefault();this.blur();a=$(this).attr("submission-id");var b=$(this);$.get("/my/competition/submission/"+a+"/toggle_make_public").success(function(a){b.html("Make your submission "+("True"==a?"private":"public"))}).error(function(){alert("Error making submission public, is your Internet connection working?")});
return!1};c.updateSubmissionDescription=function(a){a.preventDefault();var b=this;b.blur();a=$(this).attr("submission-id");var d=$(this).parent().find('textarea[name="updated_description"]').val()||"",d=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");$.post("/competitions/update_description/"+a,{updated_description:d}).success(function(){$(b).parent().find(".submission_description").html("<b>Description:</b> <br><pre>"+d+"</pre>");$(b).parent().find('textarea[name="updated_description"]').val("").hide();
$(b).parent().find(".update_description_btn").removeClass("hide").show();$(b).hide()}).error(function(){alert("Error updating description, is your Internet connection working?")})};c.showOrHideSubmissionDetails=function(a){var b=$(a).parents("tr")[0];if($(a).hasClass("glyphicon-minus"))$(a).removeClass("glyphicon-minus"),$(a).addClass("glyphicon-plus"),$(b).next("tr.trDetails").remove();else{$(a).removeClass("glyphicon-plus");$(a).addClass("glyphicon-minus");a=$("#submission_details_template .trDetails").clone();
a.find(".tdDetails").attr("colspan",b.cells.length);a.find("a").each(function(a){$(this).attr("href",$(this).attr("href").replace("_",b.id))});void 0!==$(b).attr("data-description")&&a.find(".submission_description").html("<b>Description:</b> <br><pre>"+$(b).attr("data-description")+"</pre>");$(b).attr("data-team-name")&&a.find(".submission_team_name").html("<b>Team name:</b> "+$(b).attr("data-team-name"));$(b).attr("data-method-name")&&a.find(".submission_method_name").html("<b>Method name:</b> "+
$(b).attr("data-method-name"));$(b).attr("data-method-description")&&a.find(".submission_method_description").html("<b>Method description:</b><br><p>"+$(b).attr("data-method-description")+"</p>");$(b).attr("data-project-url")&&a.find(".submission_project_url").html('<b>Project URL:</b> <a href="'+$(b).attr("data-project-url")+'">'+$(b).attr("data-project-url")+"</a>");$(b).attr("data-publication-url")&&a.find(".submission_publication_url").html('<b>Publication URL:</b> <a href="'+$(b).attr("data-publication-url")+
'">'+$(b).attr("data-publication-url")+"</a>");$(b).attr("data-bibtex")&&a.find(".submission_bibtex").html("<b>Bibtex:</b><br><pre>"+$(b).attr("data-bibtex")+"</pre>");$(b).attr("data-organization-or-affiliation")&&a.find(".submission_organization_or_affiliation").html("<b>Organization/affiliation:</b> "+$(b).attr("data-organization-or-affiliation"));$(b).attr("data-exception")&&a.find(".traceback").html("Error: <br><pre>"+$(b).attr("data-exception")+"</pre>");var d=$(b).attr("data-is-public")?"private":
"public";a.find(".public_link").html("Make your submission "+d);a.find(".public_link").click(c.toggleSubmissionPublic);a.find(".public_link").attr("submission-id",b.id);a.find(".save_description_btn").click(c.updateSubmissionDescription);a.find(".save_description_btn").attr("submission-id",b.id);a.find(".update_description_btn").click(function(){var a=$(this).parent().find(".submission_description").text(),a=-1!==a.indexOf("Description: ")?a.substr(13):"";$(this).parent().find(".save_description_btn").removeClass("hide").show();
$(this).parent().find('textarea[name="updated_description"]').removeClass("hide").show().val(a);$(this).hide()});var d=$("#phasestate").val(),e=$(b).find("input[name='state']").val();if(1==d&&1==e){var f=a.find(".leaderboard_button");f.removeClass("hide");var d=$(b).find(".status").hasClass("submitted"),k=$("#competitionId").val();g(f,d);f.on("click",function(){h(k,b.id,$("#cstoken").val(),f)})}else{d=$.trim($(b).find(".statusName").html());f=a.find(".leaderboard_button").addClass("hide");if("Submitting"===
d||"Submitted"===d||"Running"===d)f.removeClass("hide"),f.text("Refresh status"),f.on("click",function(){c.updateSubmissionStatus($("#competitionId").val(),b.id,this)});"Failed"!==d&&"Cancelled"!==d||a.find("a").removeClass("hide")}$(b).after(a)}};c.updateSubmissionStatus=function(a,b,d){$(d).parents(".submission_details").find(".preloader-handler").append("<div class='competitionPreloader'></div>").children().css({top:"25px",display:"block"});$.ajax({type:"GET",url:"/api/competition/"+a+"/submission/"+
b,cache:!1,success:function(e){$("#user_results #"+b).find(".statusName").html(c.getSubmissionStatus(e.status));if("finished"===e.status)$("#user_results #"+b+"input:hidden").val("1"),1==$("#phasestate").val()?(0<$("#disallow_leaderboard_modifying").length?($(d).text("Leaderboard modifying disallowed").attr("disabled","disabled"),0<$("#forced_to_leaderboard").length&&($(".glyphicon-ok").remove(),$($("#"+b+" td")[4]).html('<span class="glyphicon glyphicon-ok"></span>'))):0==$("#forced_to_leaderboard").length?
($(d).addClass("leaderBoardSubmit"),$(d).text("Submit to Leaderboard")):($(".glyphicon-ok").remove(),$($("#"+b+" td")[4]).html('<span class="glyphicon glyphicon-ok"></span>'),$(d).removeClass("leaderBoardSubmit"),$(d).addClass("leaderBoardRemove"),$(d).text("Remove from Leaderboard")),$(d).unbind("click").off("click").on("click",function(){h(a,b,$("#cstoken").val(),$(d))})):$(d).addClass("hide");else if("failed"===e.status||"cancelled"===e.status)$(d).addClass("hide"),$(d).parent().parent().find("a").removeClass("hide"),
e.exception_details&&$('a[href="traceback/'+b+'/"]').parent().html("Error: <br><pre>"+e.exception_details+"</pre>");$(".competitionPreloader").hide()},error:function(a,b,d){}})};c.initialize=function(){$(document).ready(function(){$("#participate_form").submit(function(a){a.preventDefault();if($("#participateButton").hasClass("disabledStatus"))return!1;$("#result").html("");a=$(this).serialize();var b=$("#competitionId").val();request=$.ajax({url:"/api/competition/"+b+"/participate/",type:"post",
dataType:"text",data:a,success:function(a,e,f){$(".content form").replaceWith(c.displayRegistrationStatus(b))},error:function(a,b,c){alert("There was a problem registering for this competition.")}});return!1});$("#submissions_phase_buttons .btn").each(function(a,b){$(this).click(function(){var a=$.trim($(this).attr("id").replace("submissions_phase_",""));$("#submissions_phase_buttons .btn").removeClass("selected");$(this).addClass("selected");var b=$("#competitionId").val(),f=$("#cstoken").val();
c.getPhaseSubmissions(b,a,f)})});$("#results_phase_buttons .btn").each(function(a,b){$(this).click(function(){var a=$.trim($(this).attr("id").replace("results_phase_",""));$("#results_phase_buttons .btn").removeClass("selected");$(this).addClass("selected");var b=$("#competitionId").val();c.getPhaseResults(b,a)})});$("#results_phase_submissions .btn").click(function(a){a=$.trim($(this).attr("id").replace("public_results_phase_",""));var b=$("#competitionId").val();c.getPublicPhaseSubmisisons(b,a)});
$(".top-bar-section ul > li").removeClass("active");$("#liCompetitions").addClass("active");$("#competition-publish-button").click(function(a){a.preventDefault();var b=$(this).parent()[0];request=$.ajax({url:$(this).attr("href"),success:function(a,c,f){console.log("Published competition.");$(b).children("#competition-publish-button").hide();$(b).children("#competition-delete-button").hide();$(b).children("#competition-unpublish-button").show()},error:function(a,b,c){a=$.parseJSON(a.responseJSON);
a.error&&alert(a.error);console.log("Error publishing competition!")}})});$("#competition-unpublish-button").click(function(a){a.preventDefault();var b=$(this).parent()[0];request=$.ajax({url:$(this).attr("href"),success:function(a,c,f){console.log("Unpublished competition.");$(b).children("#competition-publish-button").show();$(b).children("#competition-delete-button").show();$(b).children("#competition-unpublish-button").hide()},error:function(a,b,c){console.log("Error unpublishing competition!")}})});
$("#my_managing .competition-tile .competition-actions").each(function(a,b){"True"==$(this)[0].getAttribute("published")?($(this).find("#competition-delete-button").hide(),$(this).find("#competition-publish-button").hide(),$(this).find("#competition-unpublish-button").show()):($(this).find("#competition-delete-button").show(),$(this).find("#competition-publish-button").show(),$(this).find("#competition-unpublish-button").hide())})})}})(Competition||(Competition={}));var csrftoken;function csrfSafeMethod(c){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(c)}function sameOrigin(c){var g="//"+document.location.host,h=document.location.protocol+g;return c==h||c.slice(0,h.length+1)==h+"/"||c==g||c.slice(0,g.length+1)==g+"/"||!/^(\/\/|http:|https:).*/.test(c)}$(function(){csrftoken=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(c,g){!csrfSafeMethod(g.type)&&sameOrigin(g.url)&&c.setRequestHeader("X-CSRFToken",csrftoken)}})});var CodaLab;
(function(c){var g=function(){function c(a){var b=this;this.defaultOptions={buttonId:"fileUploadButton",disabledClassName:"disabled",validateBeforeFilePrompt:function(){return!0},beforeSelection:function(){},afterSelection:function(a,b){},uploadProgress:function(a,b,d){},uploadSuccess:function(a){},uploadError:function(a){},allowedFileTypes:void 0,extensionToFileType:{zip:"application/zip"},maxFileSizeInBytes:void 0,maxBlockSizeInBytes:1048576};this.options=$.extend({},this.defaultOptions,a);var d=
$("#"+this.options.buttonId);this.setupFileInput();d.after(this.fileInput);d.on("click",function(a){d.hasClass(b.options.disabledClassName)||(b.options.validateBeforeFilePrompt()?b.fileInput.click():alert("Please fill in all required fields first!"))})}c.prototype.setupFileInput=function(){var a=this,b=this.fileInput;this.fileInput=$(document.createElement("input"));this.fileInput.attr("type","file");this.fileInput.attr("style","visibility: hidden; width: 1px; height: 1px;");this.fileInput.on("change",
function(b){a.options.beforeSelection();b=a.validate();var d=0<b.files.length&&!0===c.selectionIsValid(b);a.options.afterSelection(b,d);d?a.beginUpload(b,0):a.setupFileInput()});void 0!==b&&b.replaceWith(this.fileInput)};c.prototype.validate=function(){var a=this,b=this.fileInput.get(0).files,c=[];0<b.length&&$.each(b,function(b,d){var e=[];a.options.maxFileSizeInBytes&&d.size>a.options.maxFileSizeInBytes&&e.push({kind:"size-error"});var f=d.type;if(""===f){var g=d.name.split(".");1<g.length&&(f=
a.options.extensionToFileType[g.pop().toLowerCase()])}a.options.allowedFileTypes&&-1===$.inArray(f,a.options.allowedFileTypes)&&e.push({kind:"type-error"});c.push({file:d,errors:e})});return{files:c}};c.selectionIsValid=function(a){return 0===a.files.map(function(a){return a.errors.length}).reduce(function(a,c,e,f){return a+c},0)};c.prototype.getCurrentFile=function(){if(void 0!==this.state)return this.state.selection.files[this.state.fileIndex].file};c.prototype.getFileReader=function(){var a=this,
b=new FileReader;b.onload=function(b){var c=a.state.sasUrl+"&comp=block&blockid="+a.state.blockIds[a.state.blockIds.length-1];b=new Uint8Array(b.target.result);var d=a.state.sasVersion;$.ajax({url:c,type:"PUT",data:b,processData:!1,beforeSend:function(a){a.setRequestHeader("x-ms-version",d);a.setRequestHeader("x-ms-blob-type","BlockBlob")},success:function(b,c){var d=a.getCurrentFile();a.options.uploadProgress(d,a.state.bytesUploaded,d.size);a.state.bytesUploaded<d.size?a.upload():a.endUpload()},
error:function(b,c,d){a.options.uploadError({kind:"write-error",jqXHR:b,file:a.getCurrentFile()})}})};b.onerror=function(b){a.options.uploadError({kind:"read-error",message:b.message,file:a.getCurrentFile()})};return b};c.prototype.beginUpload=function(a,b){this.state={sasUrl:void 0,sasVersion:void 0,trackingId:void 0,reader:void 0,selection:a,fileIndex:b,blockIds:[],bytesUploaded:0};var c=this.getCurrentFile(),e=this;$.ajax({url:e.options.sasEndpoint,type:"POST",data:{name:c.name,type:c.type,size:c.size},
success:function(a,b){e.state.sasUrl=a.url;e.state.sasVersion=a.version;e.state.trackingId=a.id;e.state.reader=e.getFileReader();e.options.uploadProgress(c,e.state.bytesUploaded,c.size);e.upload()},error:function(a,b,c){e.options.uploadError({kind:"sas-error",jqXHR:a,file:e.getCurrentFile()})}})};c.prototype.upload=function(){var a=this.getCurrentFile(),b=this.state.bytesUploaded,c=b+Math.min(a.size-b,this.options.maxBlockSizeInBytes),a=a.slice(b,c),b="000000"+(this.state.blockIds.length+1),b=btoa(b.substring(b.length-
6));this.state.blockIds.push(b);this.state.bytesUploaded=c;this.state.reader.readAsArrayBuffer(a)};c.prototype.endUpload=function(){var a=this.state.sasUrl+"&comp=blocklist",b=this.getCurrentFile(),c=['<?xml version="1.0" encoding="utf-8"?>'];c.push("<BlockList>");for(var e=0;e<this.state.blockIds.length;e++)c.push("  <Latest>"+this.state.blockIds[e]+"</Latest>");c.push("</BlockList>");var f=this;$.ajax({url:a,type:"PUT",contentType:"application/xml",processData:!1,data:c.join("\n"),beforeSend:function(a){a.setRequestHeader("x-ms-version",
f.state.sasVersion);a.setRequestHeader("x-ms-blob-content-type",b.type);a.setRequestHeader("x-ms-meta-name",b.name);a.setRequestHeader("x-ms-meta-size",b.size.toString())},success:function(a,c){f.options.uploadSuccess(b,f.state.trackingId);var d=1+f.state.fileIndex;d<f.state.selection.files.length?f.beginUpload(f.state.selection,d):f.setupFileInput()},error:function(a,b,c){f.options.uploadError({kind:"write-error",jqXHR:a,file:f.getCurrentFile()})}})};c.isSupported=function(){return window.File&&
window.FileReader&&window.FileList&&window.Blob?!0:!1};return c}();c.FileUploader=g;(function(c){c.CreateReady=function(){!1===g.isSupported()?($("#uploadButton").addClass("disabled"),$("#details").html("Sorry, your browser does not support the HTML5 File API. Please use a newer browser.")):new g({buttonId:"uploadButton",sasEndpoint:"/api/competition/create/sas",allowedFileTypes:["application/zip","application/x-zip-compressed"],maxFileSizeInBytes:1073741824,beforeSelection:function(a,b){$("#uploadButton").addClass("disabled")},
afterSelection:function(a,b){!1===b&&(0<a.files.length&&("type-error"===a.files[0].errors[0].kind?$("#details").html('<div class="alert alert-error">Please select a valid file. Only ZIP files are accepted.</div>'):$("#details").html('<div class="alert alert-error">The files that you selected is too large. There is a 20GB size limit.</div>')),$("#uploadButton").removeClass("disabled"))},uploadProgress:function(a,b,c){b=(100*b/c).toFixed(0);$("#details").html('<div class="alert alert-info">Uploading file <strong>'+
a.name+"</strong>: "+b+'% complete.</div><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="'+b+'" aria-valuemin="0" aria-valuemax="100" style="width: '+b+'%"></div></div>')},uploadError:function(a){$("#details").html('<div class="alert alert-error">There was an error uploading the file. Please try again.</div>');$("#uploadButton").removeClass("disabled")},uploadSuccess:function(a,b){$("#details").html('<div class="alert alert-info alert-waiting">Creating competition... This may take a while. Please be patient.</div>');
$.ajax({url:"/api/competition/create",type:"post",cache:!1,data:{id:b,name:a.name,type:a.type,size:a.size}}).done(function(a){var b=function(){$.ajax({url:"/api/competition/create/"+a.token,type:"get",cache:!1,data:{csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val()}}).done(function(a){"finished"==a.status?($("#details").html("Congratulations! Your new competition is ready to <a href='/competitions/"+a.id+"'>view</a>. You can also manage it from <a href='/my/#my_managing'>your CodaLab dashboard.</a>"),
$("#uploadButton").removeClass("disabled")):"failed"==a.status?($("#details").html('<div class="alert alert-error">Oops! There was a problem creating the competition: <br><pre>'+a.error+"</pre></div>"),$("#uploadButton").removeClass("disabled")):setTimeout(b,1E3)}).fail(function(){$("#details").html('<div class="alert alert-error">An unexpected error occurred.</div>');$("#uploadButton").removeClass("disabled")})};b()}).fail(function(){$("#details").html('<div class="alert alert-error">An unexpected error occurred.</div>');
$("#uploadButton").removeClass("disabled")})}})}})(c.Competitions||(c.Competitions={}))})(CodaLab||(CodaLab={}));//# sourceMappingURL=/static/codalab.min.map
